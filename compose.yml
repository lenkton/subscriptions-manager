services:
  db:
    image: postgres:17.5-alpine3.22
    env_file:
      - .postgres.env
    # TODO: do not really need this for production
    ports:
      - 5432:5432
    volumes:
      - ./db-data:/var/lib/postgresql/data

  # NOTE: maybe it is not a good solution, but whatever
  migrate:
    profiles:
      - one-timers
    image: migrate/migrate:v4.18.3
    command: "-path /migrations/ -database \"postgres://${POSTGRES_USER}:${POSTGRES_PASSWORD}@db:5432/${POSTGRES_DB}?sslmode=disable\" up"
    volumes:
      - ./db/migrations/:/migrations

